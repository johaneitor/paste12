<!doctype html>
<html lang="es">
<head>
  <meta name="ads-client" content="ca-pub-XXXXXXXXXXXXXXX">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>paste12</title>
  <link rel="stylesheet" href="/css/styles.css">
  <!-- Ads (sólo cambia tu client y slot cuando tengas el ID) -->
  <link rel="preconnect" href="https://pagead2.googlesyndication.com">
  <link rel="preconnect" href="https://googleads.g.doubleclick.net">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
</head>
<body>
  <header class="topbar">
    <h1 style="margin:0">Notas</h1>
  </header>

  <!-- Bloque de anuncio responsivo -->
  <section class="adwrap" style="max-width:860px;margin:12px auto">
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </section>

  <main class="container">
    <form id="noteForm" style="display:grid;gap:8px;margin-top:8px">
      <textarea name="text" placeholder="Escribe tu nota…" required></textarea>
      <input type="number" id="hours" name="hours" value="24" min="1" max="720">
      <button type="submit">Publicar</button>
      <span id="status"></span>
    </form>
    <ul id="notes" style="list-style:none;padding:0;margin:16px 0"></ul>
    <section id="ad-below-form" class="ad-slot"><!-- ad slot --></section>
  
  <button id="loadMore" class="load-more" style="display:none;margin:12px auto;padding:8px 14px;border:1px solid #253044;border-radius:10px;background:#0d1320;color:#eaf2ff">Cargar más</button>

</main>
  <footer class="site">
    <a href="/terms.html">Términos y Condiciones</a> · <a href="/privacy.html">Política de Privacidad</a>
  </footer>

  <footer class="footer">
    <a href="/terms.html">Términos</a> ·
    <a href="/privacy.html">Privacidad</a>
  </footer>

  <!-- Consentimiento -->
  <div id="consent" class="consent is-hidden" aria-hidden="true"
       style="position:fixed;left:0;right:0;bottom:0;padding:10px 14px;display:flex;gap:10px;align-items:center;z-index:9998">
    Usamos cookies/localStorage (por ejemplo, para contar vistas y mostrar anuncios).
    Al continuar aceptás nuestros <a href="/terms.html">Términos</a> y
    <a href="/privacy.html">Política de Privacidad</a>.
    <button id="consentAccept" style="margin-left:auto">Aceptar</button>
  </div>

  <script src="/js/app.js?v=3"></script>
  <script>
  // Banner de consentimiento fiable
  document.addEventListener('DOMContentLoaded', function(){
    try{
      var c = document.getElementById('consent');
      var b = document.getElementById('consentAccept');
      var has = (localStorage.getItem('consent') === '1');
      if (has) { c.classList.add('is-hidden'); c.setAttribute('hidden',''); c.setAttribute('aria-hidden','true'); }
      else     { c.classList.remove('is-hidden'); c.removeAttribute('hidden'); c.setAttribute('aria-hidden','false'); }
      b && b.addEventListener('click', function(){
        try{ localStorage.setItem('consent','1'); }catch(e){}
        c.classList.add('is-hidden'); c.setAttribute('hidden',''); c.setAttribute('aria-hidden','true');
      });
    }catch(e){}
  });
  </script>

<!-- p12 debug bootstrap -->
<script id="debug-bootstrap-p12">
(function () {
  try {
    var p = new URLSearchParams(location.search);
    if (!p.has('debug')) return;

    // 1) Desregistrar SW antiguos (no rompe si no hay)
    if ('serviceWorker' in navigator) {
      try {
        navigator.serviceWorker.getRegistrations().then(function(rs){
          rs.forEach(function(r){ r.unregister(); });
        });
      } catch (_e) {}
    }

    // 2) UI mínima de diagnóstico
    function addBox() {
      var box = document.createElement('div');
      box.style.cssText = 'position:fixed;right:12px;bottom:12px;padding:10px 12px;background:#111;color:#fff;font:12px/1.4 system-ui;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,.3);max-width:42ch;z-index:99999';
      box.innerHTML = '<b>p12 debug</b><div id="p12d"></div>';
      document.body.appendChild(box);
      return box.querySelector('#p12d');
    }
    function log(k,v){
      var el = document.createElement('div');
      el.textContent = k + ': ' + v;
      root.appendChild(el);
    }

    var root = addBox();

    // 3) checks rápidos
    fetch('/api/health').then(function(r){ log('health', r.status); }).catch(function(){ log('health','ERR'); });

    fetch('/api/deploy-stamp')
      .then(function(r){ return r.json(); })
      .then(function(j){
        var c = ((j && j.deploy && j.deploy.commit) || j.commit || '').slice(0,7);
        var d = ((j && j.deploy && j.deploy.date)   || j.date   || '');
        log('deploy', c + ' @ ' + d);
      })
      .catch(function(){ log('deploy','ERR'); });

    fetch('/api/notes?limit=3', {headers:{'Accept':'application/json'}})
      .then(function(r){ return r.json(); })
      .then(function(j){
        var n = (Array.isArray(j) ? j.length : ((j && j.items && j.items.length) || 0));
        log('notes', n + ' items');
      })
      .catch(function(){ log('notes','ERR'); });

  } catch (_e) {}
})();
</script>


<!-- p12 PE shim (solo ?pe=1) -->
<script id="pe-shim-p12">
(function(){
  try {
    var p = new URLSearchParams(location.search);
    if (!p.has('pe')) return;

    var root = document.createElement('div');
    root.style.cssText = 'margin:16px;padding:12px;border:1px dashed #aaa;border-radius:10px;background:#fafafa';
    root.innerHTML = '<b>PE shim</b> — listado mínimo de /api/notes';
    var list = document.createElement('div');
    list.style.cssText = 'margin-top:8px;font:14px system-ui';
    root.appendChild(list);
    (document.body || document.documentElement).appendChild(root);

    fetch('/api/notes?limit=5',{headers:{'Accept':'application/json'}})
      .then(function(r){ return r.json(); })
      .then(function(j){
        var items = (j && j.items) || [];
        if (!items.length) { list.textContent = '(sin items)'; return; }
        var ul = document.createElement('ul');
        items.forEach(function(it){
          var li = document.createElement('li');
          li.textContent = '#'+it.id+': '+(it.text || it.summary || '(sin texto)');
          ul.appendChild(li);
        });
        list.appendChild(ul);
      })
      .catch(function(){ list.textContent = 'error cargando'; });
  } catch (_e) {}
})();
</script>

<script id="p12-client-template" data-ver="2">
(()=>{const $$=(s,sc)=>Array.from((sc||document).querySelectorAll(s));const $=(s,sc)=> (sc||document).querySelector(s);

// --- 0) Bloquear SW + quitar banners de “Nueva versión disponible” ---
(async function killSW(){
  try{
    if("serviceWorker" in navigator){
      // Evitar nuevos registros
      try{navigator.serviceWorker.register = ()=>Promise.resolve({});}catch{}
      // Desregistrar existentes
      const regs = await navigator.serviceWorker.getRegistrations();
      for(const r of regs){ try{ await r.unregister(); }catch{} }
    }
  }catch{}
})();
function killUpdateBanners(){
  const BAD_TXT = [/nueva versión disponible/i, /actualiza para ver los últimos cambios/i, /update available/i];
  const nodes = $$('body *');
  for(const el of nodes){
    const t = (el.textContent||"").trim();
    if(!t) continue;
    if(BAD_TXT.some(rx=>rx.test(t))){
      // Quita el contenedor completo si es un toast/banner
      try{ el.closest('[role="alert"], .toast, .snackbar, .banner')?.remove(); }catch{}
      // O al menos ese nodo
      try{ el.remove(); }catch{}
    }
  }
}
killUpdateBanners();
new MutationObserver(()=>killUpdateBanners()).observe(document.documentElement,{childList:true,subtree:true});

// --- 1) Heurísticas para detectar items de nota y el feed correcto ---
function looksLikeNote(el){
  if(!el || !el.textContent) return false;
  const t = el.textContent;
  if(!/#\s?\d{1,10}\b/.test(t)) return false;       // meta tipo “#253”
  // Evita héroes: si contiene H1/H2 grande y no hay #id cerca, descartamos
  const hasHero = el.querySelector('h1,h2');
  if(hasHero && !el.querySelector('*:not(h1):not(h2)')) return false;
  return true;
}
function findFeed(){
  // Tomamos todos los contenedores que tengan ≥2 hijos que parezcan nota,
  // y nos quedamos con el de mayor “score”.
  let best=null, bestScore=0;
  const all = $$('main, [data-feed], #notes, .notes, #list, #root, body, .container, .content, .wrapper, .page');
  for(const cand of all){
    const kids = Array.from(cand.children||[]);
    let score=0;
    for(const ch of kids){ if(looksLikeNote(ch)) score++; }
    if(score>bestScore){ best=cand; bestScore=score; }
  }
  // Si no se encontró, fallback al body
  return best || document.body;
}
const feed = findFeed();
if(!feed){ console.warn("[p12] no feed; abort"); return; }

// --- 2) Elegir template real: primer hijo del feed que parezca nota ---
let templateCard = Array.from(feed.children||[]).find(looksLikeNote);
if(templateCard){ templateCard = templateCard.cloneNode(true); }
const seen = new Set();
// Marcar los ya renderizados para no duplicar
(Array.from(feed.querySelectorAll('[data-note-id]'))).forEach(el=>{
  const id = Number(el.getAttribute('data-note-id')); if(Number.isFinite(id)) seen.add(id);
});
(Array.from(feed.children||[])).forEach(el=>{
  const m=/#\s?(\d{1,10})\b/.exec(el.textContent||''); if(m){ const id=Number(m[1]); if(Number.isFinite(id)) seen.add(id); }
});

function findNth(el, sels){ for(const s of sels){ const n=el.querySelector(s); if(n) return n; } return null; }
function fillCard(card, it){
  try{ card.setAttribute('data-note-id', it.id); }catch{}
  // Texto
  const textNode = findNth(card, ['[data-text]', '.text', '.content', 'p', 'div']);
  if(textNode) textNode.textContent = it.text ?? it.title ?? '';
  // Meta
  const meta = findNth(card, ['[data-meta]', '.meta', '.foot', 'small', '.muted']);
  if(meta){
    const parts=[`#${it.id}`];
    const L = (it.likes ?? 0);
    parts.push(String(L));
    if(it.views != null) parts.push(String(it.views));
    meta.textContent = meta.textContent?.replace(/#\s?\d{1,10}.*/,'') || '';
    meta.textContent = `#${it.id} · ${new Date(it.timestamp||Date.now()).toLocaleString()} · ${L} `;
  }
  // Acciones (fallback si el template no trae)
  let bar = findNth(card, ['.p12-actions', '.actions', '.toolbar']);
  if(!bar){ bar = document.createElement('div'); bar.className='p12-actions';
    bar.style.cssText='display:flex;gap:8px;margin-top:10px;align-items:center;flex-wrap:wrap'; card.append(bar);
  }
  // LIKE
  let likeBtn = Array.from(card.querySelectorAll('button,a')).find(b=>/❤️|like/i.test((b.textContent||'')));
  if(!likeBtn){ likeBtn=document.createElement('button'); likeBtn.type='button'; likeBtn.textContent=`❤️ ${it.likes??0}`;
    likeBtn.style.cssText='padding:.3rem .6rem;border:1px solid #eee;border-radius:8px;background:#fff;cursor:pointer'; bar.prepend(likeBtn); }
  likeBtn.addEventListener('click', async (ev)=>{
    ev.preventDefault(); likeBtn.disabled=true;
    try{ const r=await fetch(`/api/notes/${it.id}/like`,{method:'POST',credentials:'include'});
         const d=await r.json().catch(()=>({})); const L=d?.likes ?? (it.likes??0)+1; likeBtn.textContent=`❤️ ${L}`;
    }catch{} finally{ likeBtn.disabled=false; }
  }, {once:false});
  // REPORT
  let repBtn = Array.from(card.querySelectorAll('button,a')).find(b=>/🚩|report/i.test((b.textContent||'')));
  if(!repBtn){ repBtn=document.createElement('button'); repBtn.type='button'; repBtn.textContent='🚩 Reportar';
    repBtn.style.cssText='padding:.3rem .6rem;border:1px solid #eee;border-radius:8px;background:#fff;cursor:pointer'; bar.append(repBtn); }
  repBtn.addEventListener('click', async (ev)=>{
    ev.preventDefault(); if(!confirm('¿Reportar esta nota?')) return; repBtn.disabled=true;
    try{ const r=await fetch(`/api/notes/${it.id}/report`,{method:'POST',credentials:'include'});
         const d=await r.json().catch(()=>({})); if(d?.removed){ card.replaceChildren(Object.assign(document.createElement('div'),{textContent:'Nota ocultada por reportes.',style:'color:#b00'})); }
         else if(d?.reports!=null){ repBtn.textContent=`🚩 Reportar (${d.reports})`; }
    }catch{} finally{ repBtn.disabled=false; }
  }, {once:false});
  // SHARE
  let shBtn = Array.from(card.querySelectorAll('button,a')).find(b=>/🔗|share|compart/i.test((b.textContent||'')));
  if(!shBtn){ shBtn=document.createElement('button'); shBtn.type='button'; shBtn.textContent='🔗 Compartir';
    shBtn.style.cssText='padding:.3rem .6rem;border:1px solid #eee;border-radius:8px;background:#fff;cursor:pointer'; bar.append(shBtn); }
  shBtn.addEventListener('click', async (ev)=>{
    ev.preventDefault(); const url=`${location.origin}/api/notes/${it.id}`; const text=it.text||`Nota #${it.id}`;
    try{ if(navigator.share){ await navigator.share({title:`Nota #${it.id}`, text, url}); }
         else{ await navigator.clipboard.writeText(url); const o=shBtn.textContent; shBtn.textContent='✅ Copiado'; setTimeout(()=>shBtn.textContent=o,1400); } }catch{}
  }, {once:false});
  return card;
}

function renderItems(items,{append=true}={}){
  for(const it of (items||[])){
    const id = Number(it?.id); if(!Number.isFinite(id) || seen.has(id)) continue;
    seen.add(id);
    let card = templateCard ? templateCard.cloneNode(true) : document.createElement('div');
    card = fillCard(card, it);
    append ? feed.append(card) : feed.prepend(card);
  }
}

const moreBtn = (()=>{ let b=document.getElementById('p12-more');
  if(!b){ b=document.createElement('button'); b.id='p12-more'; b.type='button'; b.textContent='Cargar más';
    b.style.cssText='margin:12px 0; padding:.6rem 1rem; border-radius:10px; border:1px solid #ddd; background:#fff; cursor:pointer; display:none';
    feed.after(b);
  } return b;
})();

let nextUrl=null;
async function fetchPage(url){
  const res=await fetch(url,{credentials:"include"}); const data=await res.json().catch(()=>({ok:false,error:"json"}));
  if(!res.ok){ console.warn("HTTP",res.status,data?.error); return; }
  renderItems(data.items||[], {append:true});
  // Next por Link:
  nextUrl=null; const link=res.headers.get("Link")||res.headers.get("link");
  if(link){ const m=/<([^>]+)>;\s*rel="?next"?/i.exec(link); if(m) nextUrl=m[1]; }
  // Next por X-Next-Cursor:
  if(!nextUrl){
    try{ const xn=JSON.parse(res.headers.get("X-Next-Cursor")||"null");
         if(xn&&xn.cursor_ts&&xn.cursor_id){ nextUrl=`/api/notes?cursor_ts=${encodeURIComponent(xn.cursor_ts)}&cursor_id=${xn.cursor_id}`; }
    }catch{}
  }
  moreBtn.style.display = nextUrl ? "" : "none";
}

function pickTextarea(){ return document.querySelector('textarea[name=text], #text, textarea'); }
function pickTTL(){ return document.querySelector('select[name=hours], select[name=ttl], input[name=ttl_hours], select'); }
async function publish(ev){
  if(ev&&ev.preventDefault) ev.preventDefault();
  const ta=pickTextarea(); const ttlSel=pickTTL();
  const text=(ta?.value||"").trim(); if(!text){ alert("Escribe algo primero"); return; }
  const payload={text}; if(ttlSel){ const v=Number(ttlSel.value||ttlSel.getAttribute("value")||12); if(Number.isFinite(v)&&v>0) payload.ttl_hours=v; }
  const res=await fetch("/api/notes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload),credentials:"include"});
  const data=await res.json().catch(()=>({ok:false,error:"json"}));
  if(!res.ok || data?.ok===false){ alert("Error publicando: "+(data?.error||("HTTP "+res.status))); return; }
  try{ ta.value=""; }catch{}
  const it = data.item || {id:data.id,text:payload.text,likes:data.likes||0,timestamp:Date.now()};
  let card = templateCard ? templateCard.cloneNode(true) : document.createElement('div');
  card = fillCard(card, it);
  feed.prepend(card);
}

function bindPublish(){
  const form = document.querySelector("form");
  if(form) form.addEventListener("submit", e=>publish(e));
  const btn = Array.from(document.querySelectorAll("button, input[type=submit]"))
    .find(b=>/publicar|enviar/i.test((b.textContent||b.value||"")));
  if(btn && !btn.form) btn.addEventListener("click", e=>publish(e));
}

function start(){
  bindPublish();
  // Sólo añadimos páginas siguientes; mantenemos lo renderizado por el server
  fetchPage("/api/notes?limit=10").catch(()=>{});
}
document.addEventListener("DOMContentLoaded", start);
moreBtn.addEventListener("click", ()=>{ if(nextUrl) fetchPage(nextUrl).catch(()=>{}); });

})();
</script>



</body>
</html>
\n<!-- deploy-stamp-banner -->
<script>
(function(){
  var elId = "deploy-stamp-banner";
  if (document.getElementById(elId)) return; // idempotente

  function h(tag, attrs, text){ var e=document.createElement(tag);
    if(attrs){ for(var k in attrs){ e.setAttribute(k, attrs[k]); } }
    if(text){ e.textContent=text; } return e; }

  function show(stamp){
    var bar = h("div", {id: elId, style:
      "position:fixed;left:16px;right:16px;bottom:16px;padding:12px 16px;"+
      "background:#111;color:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.25);"+
      "font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;"+
      "display:flex;gap:12px;align-items:center;z-index:99999;"});
    var msg = h("div", null, "Nueva versión disponible. Actualiza para ver los últimos cambios.");
    var btn = h("button", {style:
      "margin-left:auto;background:#00b894;color:#fff;border:0;border-radius:8px;padding:8px 12px;cursor:pointer;"+
      "font-weight:600;"}, "Actualizar");
    btn.onclick = function(){
      try { localStorage.setItem("deployStamp", stamp || ""); } catch(_) {}
      location.reload(true);
    };
    var x = h("button",{style:"margin-left:8px;background:#333;color:#fff;border:0;border-radius:8px;padding:8px 12px;cursor:pointer;"},"Cerrar");
    x.onclick=function(){ bar.remove(); };
    bar.appendChild(msg); bar.appendChild(btn); bar.appendChild(x);
    document.body.appendChild(bar);
  }

  function same(a,b){return String(a||"").trim()===String(b||"").trim();}

  fetch("/api/deploy-stamp",{credentials:"include"}).then(function(r){return r.json();}).then(function(j){
    var cur = (j && (j.stamp||j.commit||"")) || "";
    var prev = ""; try { prev = localStorage.getItem("deployStamp")||""; } catch(_) {}
    if(!same(cur, prev) && cur){ show(cur); }
  }).catch(function(_e){ /* silencioso */ });
})();
</script>
\n
<style>/* hotfix-banner-hide */#deploy-stamp-banner{display:none!important}</style>
<script id="hotfix-client-v1">
(()=>{'use strict';
const $=s=>document.querySelector(s);
const api=p=> (p.startsWith('/')?p:'/api/'+p);

// Estado de paginación
let nextURL=null;
function setMoreVisible(v){ let b=document.getElementById('p12-hotfix-more');
  if(!b){ b=document.createElement('button'); b.id='p12-hotfix-more'; b.type='button';
    b.textContent='Cargar más'; b.style.cssText='display:block;margin:12px auto;padding:.6rem 1rem;border-radius:10px;border:1px solid #e5e7eb;background:#fff;';
    const list=$('#list')||document.body; list.after(b);
    b.onclick=()=>{ if(nextURL) fetchPage(nextURL); };
  }
  b.style.display = v ? '' : 'none';
}

function esc(s){return (s||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c]));}
function renderItem(it){
  const text = it.text || it.content || it.summary || '';
  return `
    <article class="note" data-id="${it.id}">
      <div data-text="1">${esc(text)||'(sin texto)'}</div>
      <div class="meta">#${it.id} · ❤ ${it.likes??0} · 👁 ${it.views??0}
        <button class="act like">❤</button>
        <button class="act more">⋯</button>
      </div>
      <div class="menu hidden">
        <button class="share">Compartir</button>
        <button class="report">Reportar 🚩</button>
      </div>
    </article>`;
}
function appendItems(items){
  const root = $('#list') || (function(){ const d=document.createElement('section'); d.id='list'; document.body.appendChild(d); return d; })();
  const html = (items||[]).map(renderItem).join('');
  const div = document.createElement('div'); div.innerHTML = html;
  root.append(...div.children);
}
async function fetchPage(url){
  try{
    const r=await fetch(url,{headers:{'Accept':'application/json'}});
    const j=await r.json();
    appendItems(Array.isArray(j)?j:(j.items||[]));
    nextURL=null;
    const link=r.headers.get('Link')||r.headers.get('link');
    if(link){ const m=/<([^>]+)>;\s*rel="?next"?/i.exec(link); if(m) nextURL=m[1]; }
    if(!nextURL){
      try{ const xn=JSON.parse(r.headers.get('X-Next-Cursor')||'null');
           if(xn&&xn.cursor_ts&&xn.cursor_id){ nextURL=`/api/notes?cursor_ts=${encodeURIComponent(xn.cursor_ts)}&cursor_id=${xn.cursor_id}`; }
      }catch(_){}
    }
    setMoreVisible(!!nextURL);
  }catch(_){ /* silencio */ }
}

function validateText(s){ return (s||'').trim().length>=12; }
function flash(ok,msg){
  const el = $('#msg') || (function(){ const d=document.createElement('div'); d.id='msg'; document.body.prepend(d); return d; })();
  el.className = ok?'ok':'error'; el.textContent = msg;
  setTimeout(()=>{ el.className='hidden'; el.textContent=''; }, 2000);
}

async function publish(ev){
  ev && ev.preventDefault && ev.preventDefault();
  const t = ($('#text')?.value||'').trim();
  const ttl= parseInt($('#ttl')?.value||'',10);
  if(!validateText(t)){ flash(false,'Escribí un poco más (≥ 12 caracteres).'); return; }
  const body={ text: t }; if(Number.isFinite(ttl)&&ttl>0) body.ttl_hours=ttl;

  // JSON primero
  let r=null, j=null;
  try{
    r=await fetch(api('notes'),{method:'POST',headers:{'Content-Type':'application/json','Accept':'application/json'},body:JSON.stringify(body)});
  }catch(_){}
  if(!r || !r.ok){
    // FALLBACK FORM
    const fd = new URLSearchParams(); fd.set('text',t); if(body.ttl_hours) fd.set('ttl_hours',String(body.ttl_hours));
    try{ r=await fetch(api('notes'),{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},body:fd}); }catch(_){}
  }
  try{ j = await r.json(); }catch(_){ j=null; }
  if(!r || !r.ok || !j || j.ok===false){ flash(false, (j&&j.error)||('Error HTTP '+(r&&r.status))); return; }
  // Insertar primero
  const it = j.item || {id:j.id, text:t, likes:j.likes||0, views:0, timestamp:new Date().toISOString()};
  const root = $('#list') || (function(){ const d=document.createElement('section'); d.id='list'; document.body.appendChild(d); return d; })();
  const c = document.createElement('div'); c.innerHTML = renderItem(it); root.prepend(c.firstElementChild);
  $('#text') && ($('#text').value=''); $('#ttl') && ($('#ttl').value='');
  flash(true,'Publicado ✅');
}

// Delegación acciones
document.addEventListener('click', async (e)=>{
  const like = e.target.closest && e.target.closest('button.like');
  const more = e.target.closest && e.target.closest('button.more');
  const share= e.target.closest && e.target.closest('button.share');
  const rpt  = e.target.closest && e.target.closest('button.report');
  const art  = e.target.closest && e.target.closest('article.note');
  const id   = art&&art.getAttribute('data-id');

  try{
    if(like && id){
      const r=await fetch(api(`notes/${id}/like`),{method:'POST'}); const j=await r.json().catch(()=>({}));
      if(j && typeof j.likes!=='undefined'){ const m=art.querySelector('.meta'); if(m) m.innerHTML = m.innerHTML.replace(/❤\s*\d+/, '❤ '+j.likes); }
    }else if(more && art){
      art.querySelector('.menu')?.classList.toggle('hidden');
    }else if(share && id){
      const url = `${location.origin}/?id=${id}`;
      if(navigator.share){ await navigator.share({title:`Nota #${id}`, url}); }
      else { await navigator.clipboard.writeText(url); flash(true,'Link copiado'); }
      art.querySelector('.menu')?.classList.add('hidden');
    }else if(rpt && id){
      const r=await fetch(api(`notes/${id}/report`),{method:'POST'}); const j=await r.json().catch(()=>({}));
      if(j?.removed){ art.remove(); flash(true,'Nota eliminada por reportes'); }
      else { flash(true,'Reporte enviado'); }
      art.querySelector('.menu')?.classList.add('hidden');
    }
  }catch(_){}
}, {capture:true});

// Arranque: pag 1 y botón
window.addEventListener('DOMContentLoaded',()=>{
  // publica: click y Ctrl/Cmd+Enter
  const btn = document.getElementById('send'); if(btn){ btn.addEventListener('click', publish, {capture:true}); }
  const ta  = document.getElementById('text'); if(ta){ ta.addEventListener('keydown',(e)=>{ if(e.key==='Enter'&&(e.ctrlKey||e.metaKey)) publish(e);}); }

  fetchPage('/api/notes?limit=10');
});
})();
</script>
<style>/* hotfix-banner-hide */#deploy-stamp-banner{display:none!important}</style>
